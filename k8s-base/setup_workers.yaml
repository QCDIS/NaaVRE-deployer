- hosts: master
  gather_facts: no
  tasks:

    - name: Generate join cmd
      shell: kubeadm token create --print-join-command
      register: join_cmd

    - name: Save join cmd
      add_host:
        name: join_cmd_holder
        cmd: '{{ join_cmd.stdout }}'

- hosts: workers
  gather_facts: no
  tasks:

    - name: Join cluster
      shell: "{{ hostvars['join_cmd_holder']['cmd'] }}"
      become: yes
